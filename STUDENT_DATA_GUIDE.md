# 學生資料批次產生指南

## 功能說明

批次產生 OMR 答案卡時，除了 QR Code ID 外，還可以在每張答案卡上印上個別學生的資料（如姓名、班級等）。

## 重要觀念

### QR Code 產生規則

**QR Code 只會編碼 ID 欄位的值**，用於快速識別學生身份。

- **ID 欄位** → 編碼進 QR Code（例如：`S001`、`A2024001`）
- **其他欄位** → 只會印成文字在答案卡上（例如：姓名、班級）

### 欄位彈性設計

**所有欄位都可以自訂，沒有寫死的限制！**

- ✅ 欄位名稱可以是任何文字（中文、英文皆可）
- ✅ 欄位數量沒有限制
- ✅ 可以選擇要印哪些欄位
- ✅ 空值會自動跳過不顯示

## Excel/CSV 檔案格式

### 範例格式 1：英文欄位

```csv
student_id,name,class,section
S001,Alice Wang,Grade 10,A
S002,Bob Chen,Grade 10,A
S003,Carol Li,Grade 10,B
S004,David Zhang,Grade 10,B
S005,Emma Liu,Grade 10,C
```

### 範例格式 2：中文欄位

```csv
學號,姓名,年級,班級,座號
A001,王小明,高一,仁班,5
A002,李小華,高一,仁班,12
A003,陳志豪,高一,愛班,8
```

### 範例格式 3：更多欄位

```csv
編號,姓名,班級,座號,考場,備註
2024001,張三,10A,1,第一考場,
2024002,李四,10A,2,第一考場,特殊需求
2024003,王五,10B,1,第二考場,
```

### 欄位說明

- **ID 欄位**（必填）：學生 ID，會被編碼到 QR Code 中
  - 可以是第一欄，或任意指定的欄位
  - 欄位名稱可自訂（如：`student_id`、`學號`、`編號`）

- **其他欄位**（選填）：學生資料，會印在答案卡上
  - 數量不限，名稱自訂
  - 可以選擇要印哪些欄位
  - 空值會自動跳過

## Gradio 界面使用方式

### 步驟 1：上傳檔案
在「📦 批次產生答案卡」標籤中上傳 Excel 或 CSV 檔案

### 步驟 2：設定欄位

#### ID 欄位名稱（ID Column Name）
- **用途**：指定哪個欄位要編碼進 QR Code
- **範例**：
  - 輸入 `student_id` → QR Code 會編碼 student_id 欄位的值
  - 輸入 `學號` → QR Code 會編碼學號欄位的值
  - 輸入 `編號` → QR Code 會編碼編號欄位的值
- **留空**：自動使用第一欄作為 ID

#### 學生資料欄位（Student Data Columns）
- **用途**：指定哪些欄位要印在答案卡上（文字形式）
- **格式**：欄位名稱，逗號分隔
- **範例**：
  - `name,class,section` → 只印這三個欄位
  - `姓名,班級,座號` → 只印這三個欄位
  - `name,class,seat,exam_room` → 印四個欄位
- **留空**：印出所有欄位（除了 ID 欄位）

### 步驟 3：自訂共用標題（可選）
這些標題會出現在**所有答案卡**的最頂端：

- **標題第一行**：共用標題（粗體、大字）
  - 例如：`期末考試 - 數學科`
  - 例如：`113 學年度第一學期期末考`

- **標題第二行**：共用副標題
  - 例如：`考試時間：90 分鐘`
  - 例如：`班級：_____ 座號：_____`

- **標題第三行**：其他資訊
  - 例如：`日期：_____ 分數：_____`
  - 例如：`注意事項：請用 2B 鉛筆作答`

### 步驟 4：配置答案卡參數
- **題目數量**：要產生幾題（例如：20、50、100）
- **題型**：選擇題類型
  - QTYPE_MCQ4：四選一 (A/B/C/D)
  - QTYPE_MCQ5：五選一 (A/B/C/D/E)
  - QTYPE_INT：數字作答
- **欄數**：題目橫向排列幾欄
- **是否包含對齊標記**：建議勾選，提高辨識準確度
- **頁面尺寸**：預設 2100×2970（A4 比例）
- **圓圈大小**：預設 40 像素

### 步驟 5：產生批次
1. 點擊「🚀 批次產生答案卡」按鈕
2. 等待處理完成
3. 下載產生的 ZIP 檔案

## 輸出結果

### 每張答案卡包含：

1. **共用標題**（如果有設定）
   ```
   期末考試 - 數學科
   考試時間：90 分鐘
   日期：_____ 分數：_____
   ```

2. **個別學生資料**（從 Excel 讀取）
   ```
   name: Alice Wang
   class: Grade 10
   section: A
   ```

3. **題目區塊**
   - 根據設定的題數和題型產生

4. **QR Code**（右下角）
   - 內容：學生 ID（如 `S001`）

### ZIP 檔案結構

```
generated_sheets.zip
├── sheets/
│   ├── S001.png
│   ├── S002.png
│   ├── S003.png
│   └── ...
└── templates/
    ├── S001_template.json
    ├── S002_template.json
    ├── S003_template.json
    └── ...
```

## 使用範例

### 範例 1：基本使用（所有欄位）

**Excel 內容：**
```
student_id,name,class
S001,Alice,10A
S002,Bob,10B
```

**設定：**
- ID Column Name: `student_id`
- Student Data Columns: 留空（使用所有欄位）

**結果：每張答案卡會顯示**
```
name: Alice
class: 10A
[QR Code: S001]
```

### 範例 2：選擇特定欄位

**Excel 內容：**
```
student_id,name,class,phone,email
S001,Alice,10A,1234567,alice@example.com
```

**設定：**
- ID Column Name: `student_id`
- Student Data Columns: `name,class`（只印姓名和班級）

**結果：每張答案卡會顯示**
```
name: Alice
class: 10A
[QR Code: S001]
```

### 範例 3：含共用標題

**設定：**
- Header Text Line 1: `期末考試 - 數學科`
- Header Text Line 2: `班級：_____ 座號：_____`
- Student Data Columns: `name`

**結果：每張答案卡會顯示**
```
        期末考試 - 數學科
      班級：_____ 座號：_____

name: Alice Wang

[題目區塊]

            [QR Code: S001]
```

## 注意事項

1. **Excel 欄位名稱**：確保欄位名稱與設定中輸入的一致（區分大小寫）
2. **空值處理**：如果某個學生的資料欄位為空，該欄位不會顯示在答案卡上
3. **中文支援**：支援中文欄位名稱和內容
4. **文字位置**：
   - 共用標題：置中顯示於頂部
   - 學生資料：靠左顯示於標題下方
   - QR Code：右下角
5. **文字大小**：
   - 標題第一行：大字、粗體
   - 標題其他行：中字、正常
   - 學生資料：小字、正常

## 疑難排解

### 問題：找不到欄位
**錯誤訊息**：`Column 'xxx' not found`

**解決方法**：
- 檢查 Excel 檔案中的欄位名稱拼寫
- 確認欄位名稱沒有多餘的空格
- 使用 Excel 查看實際的欄位名稱

### 問題：學生資料沒有顯示
**可能原因**：
- Student Data Columns 欄位留空，但 ID Column Name 也留空
- 欄位名稱拼寫錯誤

**解決方法**：
- 明確指定 Student Data Columns
- 檢查欄位名稱

### 問題：文字重疊
**解決方法**：
- 減少學生資料欄位數量
- 調整 Page Height 增加空間
- 減少共用標題行數

## 進階技巧

### 技巧 1：製作班級座位表
在 Excel 中加入座號欄位：
```
student_id,name,seat_no
S001,Alice,1
S002,Bob,2
```

### 技巧 2：多語言支援
可以使用任何 UTF-8 支援的語言：
```
student_id,姓名,班級
S001,王小明,十年級 A 班
S002,李小華,十年級 B 班
```

### 技巧 3：條件式欄位
在 Excel 中使用公式產生欄位：
```
=IF(gender="M", "Male", "Female")
```
然後匯出為 CSV 使用
