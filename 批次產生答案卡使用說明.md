# 批次產生 OMR 答案卡使用說明

## 🎯 功能簡介

此功能可以從 Excel 或 CSV 檔案批次產生 OMR 答案卡，每張答案卡都包含：
- ✅ 獨特的 QR Code（編碼學生 ID，用於快速識別）
- ✅ 學生個人資料（姓名、班級、座號等，以文字形式印在答案卡上）
- ✅ 共用標題（考試名稱、注意事項等）
- ✅ 自動產生的題目區塊

---

## 📋 重要觀念

### QR Code vs 學生資料

| 項目 | QR Code | 學生資料欄位 |
|------|---------|------------|
| **用途** | 編碼學生 ID | 印在答案卡上供人閱讀 |
| **來源欄位** | ID 欄位（只有一個） | 其他欄位（可多個） |
| **範例** | `S001`, `A2024001` | 姓名、班級、座號等 |

**重點：**
- QR Code **只編碼 ID 欄位**，用於掃描辨識
- 其他欄位會**印成文字**在答案卡上

---

## 📊 Excel/CSV 檔案格式

### 欄位設計原則

**完全彈性！沒有固定格式！**

- ✅ 欄位名稱可以是中文或英文
- ✅ 欄位數量沒有限制
- ✅ 可以選擇要印哪些欄位
- ✅ 空值會自動跳過

### 範例 1：英文欄位

```csv
student_id,name,class,section
S001,Alice Wang,Grade 10,A
S002,Bob Chen,Grade 10,A
S003,Carol Li,Grade 10,B
```

**說明：**
- `student_id` → QR Code 編碼
- `name`, `class`, `section` → 印在答案卡上

### 範例 2：中文欄位

```csv
學號,姓名,年級,班級,座號
A001,王小明,高一,仁班,5
A002,李小華,高一,仁班,12
A003,陳志豪,高一,愛班,8
```

**說明：**
- `學號` → QR Code 編碼
- `姓名`, `年級`, `班級`, `座號` → 印在答案卡上

### 範例 3：更多欄位

```csv
編號,姓名,班級,座號,考場,備註
2024001,張三,10A,1,第一考場,
2024002,李四,10A,2,第一考場,特殊需求
2024003,王五,10B,1,第二考場,
```

**說明：**
- `編號` → QR Code 編碼
- 其他所有欄位 → 印在答案卡上（備註欄為空會自動跳過）

---

## 🖥️ Gradio 界面操作步驟

### 步驟 1：上傳學生名單

1. 開啟 Gradio 界面：http://localhost:7860
2. 點選「📦 批次產生答案卡」標籤
3. 上傳 Excel (.xlsx, .xls) 或 CSV 檔案

### 步驟 2：設定欄位對應

#### A. ID 欄位名稱（選填）

**用途：** 指定哪個欄位要編碼進 QR Code

**範例：**
- 輸入 `student_id` → QR Code = student_id 欄位的值
- 輸入 `學號` → QR Code = 學號欄位的值
- 輸入 `編號` → QR Code = 編號欄位的值
- **留空** → 自動使用第一欄

#### B. 學生資料欄位（選填）

**用途：** 指定哪些欄位要印在答案卡上（文字形式）

**格式：** 欄位名稱，逗號分隔

**範例：**
- `name,class,section` → 只印這三個欄位
- `姓名,班級,座號` → 只印這三個欄位
- `name,class,seat,exam_room` → 印四個欄位
- **留空** → 印出所有欄位（除了 ID 欄位）

#### C. Excel 工作表（選填）

- 輸入 `0` → 使用第一個工作表（預設）
- 輸入工作表名稱 → 使用指定的工作表

### 步驟 3：設定共用標題（選填）

這些標題會出現在**所有答案卡**的最頂端：

#### 標題第一行（粗體、大字）
**範例：**
- `期末考試 - 數學科`
- `113 學年度第一學期期末考`

#### 標題第二行
**範例：**
- `考試時間：90 分鐘`
- `班級：_____ 座號：_____`

#### 標題第三行
**範例：**
- `日期：_____ 分數：_____`
- `注意事項：請用 2B 鉛筆作答`

### 步驟 4：配置答案卡參數

#### 題目設定
- **題目數量：** 要產生幾題（例如：20、50、100）
- **題型：**
  - `QTYPE_MCQ4`：四選一 (A/B/C/D)
  - `QTYPE_MCQ5`：五選一 (A/B/C/D/E)
  - `QTYPE_INT`：數字作答
- **欄數：** 題目橫向排列幾欄（建議 2-4 欄）

#### 其他選項
- **包含對齊標記：** ✅ 建議勾選（提高辨識準確度）

#### 進階設定（通常不需要修改）
- **頁面寬度：** 2100 像素（A4 比例）
- **頁面高度：** 2970 像素（A4 比例）
- **圓圈大小：** 40 像素

### 步驟 5：產生批次

1. 檢查所有設定
2. 點擊「🚀 批次產生答案卡」按鈕
3. 等待處理完成（會顯示進度訊息）
4. 下載產生的 ZIP 檔案

---

## 📦 輸出結果

### ZIP 檔案結構

```
generated_sheets.zip
├── sheets/              # 個別答案卡圖檔
│   ├── S001.png
│   ├── S002.png
│   ├── S003.png
│   └── ...
└── templates/           # 對應的模板檔案（用於辨識）
    ├── S001_template.json
    ├── S002_template.json
    ├── S003_template.json
    └── ...
```

### 每張答案卡包含

**1. 共用標題區（最上方，置中）**
```
        期末考試 - 數學科
      考試時間：90 分鐘
    日期：_____ 分數：_____
```

**2. 學生資料區（共用標題下方，靠左）**
```
name: 王小明
class: 高一仁班
section: 5
```

**3. 題目區塊**
```
Q1 ⭕ ⭕ ⭕ ⭕     Q5 ⭕ ⭕ ⭕ ⭕
   A  B  C  D        A  B  C  D

Q2 ⭕ ⭕ ⭕ ⭕     Q6 ⭕ ⭕ ⭕ ⭕
   A  B  C  D        A  B  C  D
...
```

**4. QR Code（右下角）**
- 內容：學生 ID（例如 `S001`）
- 用途：掃描後快速識別學生

---

## 💡 使用範例

### 範例 1：基本使用（所有欄位）

**Excel 內容：**
```csv
student_id,name,class
S001,Alice,10A
S002,Bob,10B
```

**Gradio 設定：**
- ID 欄位名稱：`student_id`
- 學生資料欄位：留空（使用所有欄位）

**結果：每張答案卡會顯示**
```
name: Alice
class: 10A
[QR Code: S001]
```

---

### 範例 2：選擇特定欄位

**Excel 內容：**
```csv
student_id,name,class,phone,email
S001,Alice,10A,1234567,alice@example.com
```

**Gradio 設定：**
- ID 欄位名稱：`student_id`
- 學生資料欄位：`name,class`（只印姓名和班級）

**結果：每張答案卡會顯示**
```
name: Alice
class: 10A
[QR Code: S001]
```
（phone 和 email 不會顯示）

---

### 範例 3：含共用標題

**Excel 內容：**
```csv
學號,姓名,班級
A001,王小明,高一仁班
```

**Gradio 設定：**
- ID 欄位名稱：`學號`
- 學生資料欄位：`姓名,班級`
- 標題第一行：`期末考試 - 數學科`
- 標題第二行：`考試時間：90 分鐘`

**結果：每張答案卡會顯示**
```
        期末考試 - 數學科
      考試時間：90 分鐘

姓名: 王小明
班級: 高一仁班

[題目區塊]

            [QR Code: A001]
```

---

## ❓ 疑難排解

### 問題 1：找不到欄位

**錯誤訊息：**
```
Column 'xxx' not found
```

**解決方法：**
1. 檢查 Excel 檔案中的欄位名稱拼寫
2. 確認欄位名稱沒有多餘的空格
3. 區分大小寫（`Name` ≠ `name`）

---

### 問題 2：學生資料沒有顯示

**可能原因：**
- 學生資料欄位留空，但 ID 欄位名稱也留空
- 欄位名稱拼寫錯誤

**解決方法：**
- 明確指定學生資料欄位
- 檢查欄位名稱是否正確

---

### 問題 3：文字重疊

**可能原因：**
- 學生資料欄位太多
- 標題行數太多

**解決方法：**
- 減少學生資料欄位數量（只印必要的欄位）
- 調整頁面高度（在進階設定中）
- 減少共用標題行數

---

### 問題 4：QR Code 內容不正確

**檢查：**
- ID 欄位名稱設定是否正確
- Excel 檔案中 ID 欄位的值是否正確

**記住：**
- QR Code **只編碼 ID 欄位**
- 其他欄位不會進入 QR Code

---

## 🚀 進階技巧

### 技巧 1：製作班級座位表

在 Excel 中加入座號欄位：
```csv
student_id,name,seat_no,exam_room
S001,Alice,1,Room A
S002,Bob,2,Room A
```

---

### 技巧 2：多語言支援

可以使用任何 UTF-8 支援的語言：
```csv
student_id,姓名,班級,科別
S001,王小明,十年級 A 班,自然組
S002,李小華,十年級 B 班,社會組
```

---

### 技巧 3：條件式欄位

在 Excel 中使用公式產生欄位：
```excel
=IF(gender="M", "男", "女")
=CONCATENATE(grade, class)
```
然後匯出為 CSV 使用

---

### 技巧 4：批次列印設定

**建議設定：**
- 紙張大小：A4
- 列印方向：直向
- 縮放比例：100%（不要調整）
- 邊界：最小

---

## 📚 相關文件

- [完整說明文件](STUDENT_DATA_GUIDE.md)
- [字體安裝指南](fonts/README.md)
- [專案說明](README.md)

---

## 💬 常見問答

**Q: 可以用 Google Sheets 嗎？**
A: 可以！先下載為 CSV 或 Excel 格式再上傳。

**Q: QR Code 可以編碼多個欄位嗎？**
A: 目前只支援單一 ID 欄位。如需多個資訊，建議在 Excel 中先合併成一個欄位。

**Q: 可以自訂文字位置嗎？**
A: 目前共用標題置中，學生資料靠左。如需進階自訂，請修改程式碼。

**Q: 支援多少學生？**
A: 理論上沒有限制，但建議每批次不超過 500 位，避免記憶體問題。

**Q: 產生的圖檔可以直接列印嗎？**
A: 可以！預設尺寸為 A4 比例（2100×2970 像素），列印時選擇 A4 紙張即可。
